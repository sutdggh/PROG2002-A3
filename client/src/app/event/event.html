<app-header></app-header>

<div class="container">
  <div *ngIf="event" id="event-details">
    <img [src]="event.image_url" [alt]="event.name" />
    <h2> {{event.name}}</h2>
    <p><strong>Category:</strong> {{event.category}}</p>
    <p><strong>Organization:</strong> {{event.organization}}</p>
    <p><strong>Mission:</strong> {{event.mission}}</p>
    <p><strong>Contact:</strong> {{event.contact_email}} | {{event.phone}}</p>
    <p><strong>Date:</strong> {{event.start_datetime | date }} - {{event.end_datetime | date}}</p>
    <p><strong>Venue:</strong> {{event.venue_name}}, {{event.address}}, {{event.city}}, {{event.state}}</p>
    <p>{{event.description}}</p>
    <p><strong>Ticket Price:</strong> ${{(event.ticket_price_cents/100).toFixed(2)}}</p>
    <p><strong>Goal vs Raised:</strong></p>
    <div class="progress-bar">
      <div class="progress-fill" style="width:{{event.raised_amount_cents/event.goal_amount_cents*100}}%">
        ${{(event.raised_amount_cents/100).toFixed(2)}} / ${{(event.goal_amount_cents/100).toFixed(2)}}
      </div>
    </div>
    <button style="margin-top: 20px;" (click)="router.navigate(['/register', event.id])">Register</button>
  </div>

  <div *ngIf="registrations && registrations.length > 0" class="registrations">
    <h3 style="margin-top: 40px;">Registered Participants</h3>
    <table>
      <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Tickets</th>
        <th>Notes</th>
        <th>Registered At</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let r of registrations">
        <td>{{ r.registrant_name }}</td>
        <td>{{ r.contact_email }}</td>
        <td>{{ r.tickets }}</td>
        <td>{{ r.notes || '-' }}</td>
        <td>{{ r.created_at | date:'short' }}</td>
      </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="weather?.daily" class="weather-table">
    <h3 style="margin-top: 40px;">7-Day Weather Forecast</h3>
    <table>
      <thead>
      <tr>
        <th>Date</th>
        <th>Weather</th>
        <th>Max Temp (°C)</th>
        <th>Min Temp (°C)</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let day of weather.daily.time; let i = index">
        <td>{{ day }}</td>
        <td>{{ weatherCodeMap[weather.daily.weather_code[i]] || weather.daily.weather_code[i] }}</td>
        <td>{{ weather.daily.temperature_2m_max[i] }}</td>
        <td>{{ weather.daily.temperature_2m_min[i] }}</td>
      </tr>
      </tbody>
    </table>
  </div>


  <div *ngIf="message" class="message">{{message}}</div>
</div>
